/* empty css        */import{r as O,ao as C,ap as N,h as j,aq as L,ar as R,as as F,X as M,a5 as S,at as g}from"./TLrzNzNC.js";import{g as b}from"./DD5PybmM.js";const m=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function P(e,i){if(typeof e!="string")throw new TypeError("argument str must be a string");const n={},t=(i||{}).decode||z;let a=0;for(;a<e.length;){const o=e.indexOf("=",a);if(o===-1)break;let c=e.indexOf(";",a);if(c===-1)c=e.length;else if(c<o){a=e.lastIndexOf(";",o-1)+1;continue}const u=e.slice(a,o).trim();if(n[u]===void 0){let s=e.slice(o+1,c).trim();s.codePointAt(0)===34&&(s=s.slice(1,-1)),n[u]=B(s,t)}a=c+1}return n}function k(e,i,n){const r=n||{},t=r.encode||J;if(typeof t!="function")throw new TypeError("option encode is invalid");if(!m.test(e))throw new TypeError("argument name is invalid");const a=t(i);if(a&&!m.test(a))throw new TypeError("argument val is invalid");let o=e+"="+a;if(r.maxAge!==void 0&&r.maxAge!==null){const c=r.maxAge-0;if(Number.isNaN(c)||!Number.isFinite(c))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(c)}if(r.domain){if(!m.test(r.domain))throw new TypeError("option domain is invalid");o+="; Domain="+r.domain}if(r.path){if(!m.test(r.path))throw new TypeError("option path is invalid");o+="; Path="+r.path}if(r.expires){if(!_(r.expires)||Number.isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");o+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(o+="; HttpOnly"),r.secure&&(o+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":{o+="; Priority=Low";break}case"medium":{o+="; Priority=Medium";break}case"high":{o+="; Priority=High";break}default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:{o+="; SameSite=Strict";break}case"lax":{o+="; SameSite=Lax";break}case"strict":{o+="; SameSite=Strict";break}case"none":{o+="; SameSite=None";break}default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(o+="; Partitioned"),o}function _(e){return Object.prototype.toString.call(e)==="[object Date]"||e instanceof Date}function B(e,i){try{return i(e)}catch{return e}}function z(e){return e.includes("%")?decodeURIComponent(e):e}function J(e){return encodeURIComponent(e)}const v=Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0});function A(e,i){i?i={...v,...i}:i=v;const n=D(i);return n.dispatch(e),n.toString()}const K=Object.freeze(["prototype","__proto__","constructor"]);function D(e){let i="",n=new Map;const r=t=>{i+=t};return{toString(){return i},getContext(){return n},dispatch(t){return e.replacer&&(t=e.replacer(t)),this[t===null?"null":typeof t](t)},object(t){if(t&&typeof t.toJSON=="function")return this.object(t.toJSON());const a=Object.prototype.toString.call(t);let o="";const c=a.length;c<10?o="unknown:["+a+"]":o=a.slice(8,c-1),o=o.toLowerCase();let u=null;if((u=n.get(t))===void 0)n.set(t,n.size);else return this.dispatch("[CIRCULAR:"+u+"]");if(typeof Buffer<"u"&&Buffer.isBuffer&&Buffer.isBuffer(t))return r("buffer:"),r(t.toString("utf8"));if(o!=="object"&&o!=="function"&&o!=="asyncfunction")this[o]?this[o](t):e.ignoreUnknown||this.unkown(t,o);else{let s=Object.keys(t);e.unorderedObjects&&(s=s.sort());let l=[];e.respectType!==!1&&!T(t)&&(l=K),e.excludeKeys&&(s=s.filter(f=>!e.excludeKeys(f)),l=l.filter(f=>!e.excludeKeys(f))),r("object:"+(s.length+l.length)+":");const d=f=>{this.dispatch(f),r(":"),e.excludeValues||this.dispatch(t[f]),r(",")};for(const f of s)d(f);for(const f of l)d(f)}},array(t,a){if(a=a===void 0?e.unorderedArrays!==!1:a,r("array:"+t.length+":"),!a||t.length<=1){for(const u of t)this.dispatch(u);return}const o=new Map,c=t.map(u=>{const s=D(e);s.dispatch(u);for(const[l,d]of s.getContext())o.set(l,d);return s.toString()});return n=o,c.sort(),this.array(c,!1)},date(t){return r("date:"+t.toJSON())},symbol(t){return r("symbol:"+t.toString())},unkown(t,a){if(r(a),!!t&&(r(":"),t&&typeof t.entries=="function"))return this.array(Array.from(t.entries()),!0)},error(t){return r("error:"+t.toString())},boolean(t){return r("bool:"+t)},string(t){r("string:"+t.length+":"),r(t)},function(t){r("fn:"),T(t)?this.dispatch("[native]"):this.dispatch(t.toString()),e.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(t.name)),e.respectFunctionProperties&&this.object(t)},number(t){return r("number:"+t)},xml(t){return r("xml:"+t.toString())},null(){return r("Null")},undefined(){return r("Undefined")},regexp(t){return r("regex:"+t.toString())},uint8array(t){return r("uint8array:"),this.dispatch(Array.prototype.slice.call(t))},uint8clampedarray(t){return r("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(t))},int8array(t){return r("int8array:"),this.dispatch(Array.prototype.slice.call(t))},uint16array(t){return r("uint16array:"),this.dispatch(Array.prototype.slice.call(t))},int16array(t){return r("int16array:"),this.dispatch(Array.prototype.slice.call(t))},uint32array(t){return r("uint32array:"),this.dispatch(Array.prototype.slice.call(t))},int32array(t){return r("int32array:"),this.dispatch(Array.prototype.slice.call(t))},float32array(t){return r("float32array:"),this.dispatch(Array.prototype.slice.call(t))},float64array(t){return r("float64array:"),this.dispatch(Array.prototype.slice.call(t))},arraybuffer(t){return r("arraybuffer:"),this.dispatch(new Uint8Array(t))},url(t){return r("url:"+t.toString())},map(t){r("map:");const a=[...t];return this.array(a,e.unorderedSets!==!1)},set(t){r("set:");const a=[...t];return this.array(a,e.unorderedSets!==!1)},file(t){return r("file:"),this.dispatch([t.name,t.size,t.type,t.lastModfied])},blob(){if(e.ignoreUnknown)return r("[blob]");throw new Error(`Hashing Blob objects is currently not supported
Use "options.replacer" or "options.ignoreUnknown"
`)},domwindow(){return r("domwindow")},bigint(t){return r("bigint:"+t.toString())},process(){return r("process")},timer(){return r("timer")},pipe(){return r("pipe")},tcp(){return r("tcp")},udp(){return r("udp")},tty(){return r("tty")},statwatcher(){return r("statwatcher")},securecontext(){return r("securecontext")},connection(){return r("connection")},zlib(){return r("zlib")},context(){return r("context")},nodescript(){return r("nodescript")},httpparser(){return r("httpparser")},dataview(){return r("dataview")},signal(){return r("signal")},fsevent(){return r("fsevent")},tlswrap(){return r("tlswrap")}}}const U="[native code] }",$=U.length;function T(e){return typeof e!="function"?!1:Function.prototype.toString.call(e).slice(-$)===U}function H(e,i,n={}){return e===i||A(e,n)===A(i,n)}function p(e){if(typeof e!="object")return e;var i,n,r=Object.prototype.toString.call(e);if(r==="[object Object]"){if(e.constructor!==Object&&typeof e.constructor=="function"){n=new e.constructor;for(i in e)e.hasOwnProperty(i)&&n[i]!==e[i]&&(n[i]=p(e[i]))}else{n={};for(i in e)i==="__proto__"?Object.defineProperty(n,i,{value:p(e[i]),configurable:!0,enumerable:!0,writable:!0}):n[i]=p(e[i])}return n}if(r==="[object Array]"){for(i=e.length,n=Array(i);i--;)n[i]=p(e[i]);return n}return r==="[object Set]"?(n=new Set,e.forEach(function(t){n.add(p(t))}),n):r==="[object Map]"?(n=new Map,e.forEach(function(t,a){n.set(p(a),p(t))}),n):r==="[object Date]"?new Date(+e):r==="[object RegExp]"?(n=new RegExp(e.source,e.flags),n.lastIndex=e.lastIndex,n):r==="[object DataView]"?new e.constructor(p(e.buffer)):r==="[object ArrayBuffer]"?e.slice(0):r.slice(-6)==="Array]"?new e.constructor(e):e}const V={path:"/",watch:!0,decode:e=>R(decodeURIComponent(e)),encode:e=>encodeURIComponent(typeof e=="string"?e:JSON.stringify(e))},q=void 0;function h(e,i){var u;const n={...V,...i},r=x(n)||{};let t;n.maxAge!==void 0?t=n.maxAge*1e3:n.expires&&(t=n.expires.getTime()-Date.now());const a=t!==void 0&&t<=0,o=p(a?void 0:r[e]??((u=n.default)==null?void 0:u.call(n))),c=t&&!a?Y(o,t,n.watch&&n.watch!=="shallow"):O(o);{let s=null;try{!q&&typeof BroadcastChannel<"u"&&(s=new BroadcastChannel(`nuxt:cookies:${e}`))}catch{}const l=()=>{n.readonly||H(c.value,r[e])||(X(e,c.value,n),r[e]=p(c.value),s==null||s.postMessage({value:n.encode(c.value)}))},d=y=>{var w;const I=y.refresh?(w=x(n))==null?void 0:w[e]:n.decode(y.value);f=!0,r[e]=c.value=I,F(()=>{f=!1})};let f=!1;C()&&N(()=>{f=!0,l(),s==null||s.close()}),s&&(s.onmessage=({data:y})=>d(y)),n.watch?j(c,()=>{f||l()},{deep:n.watch!=="shallow"}):l()}return c}function x(e={}){return P(document.cookie,e)}function G(e,i,n={}){return i==null?k(e,i,{...n,maxAge:-1}):k(e,i,n)}function X(e,i,n={}){document.cookie=G(e,i,n)}const E=2147483647;function Y(e,i,n){let r,t,a=0;const o=n?O(e):{value:e};return C()&&N(()=>{t==null||t(),clearTimeout(r)}),L((c,u)=>{n&&(t=j(o,u));function s(){clearTimeout(r);const l=i-a,d=l<E?l:E;r=setTimeout(()=>{if(a+=d,a<i)return s();o.value=void 0,u()},d)}return{get(){return c(),o.value},set(l){s(),o.value=l,u()}}})}const ee=M("auth",{state:()=>({userDetails:null,authenticated:!1,isLoading:!0}),actions:{loadFromLocalStorage(){{const e=localStorage.getItem("authDetails");this.authenticated=!!e,this.userDetails=e?JSON.parse(e):{}}},async authStart(){this.loading=!0;const e=await $fetch(`${b()}users/oauth_start`,{method:"GET"});console.log("redirect url",e),await S(e.url,{external:!0})},async autUser(e){try{const i=await $fetch(`${b()}users/oauth-callback`,{method:"GET",query:{code:e}});g({message:"Successfully logged in",type:"success"});const n=h("refreshToken",{maxAge:60*60*24*2});n.value=i.refresh;const r=h("accessToken",{maxAge:60*60*24});r.value=i.access;const t=h("user",{maxAge:60*60*24});return t.value=JSON.stringify(i.user),this.authenticated=!0,localStorage.setItem("authDetails",JSON.stringify(i)),!0}catch(i){return g({message:i.message||"Authentication failed",type:"error"}),!1}finally{this.isLoading=!1}},async logout(){try{const e=h("refreshToken"),i=h("accessToken"),n=h("user");return e.value=null,i.value=null,n.value=null,this.authenticated=!1,g({message:"Successfully logged out",type:"success"}),localStorage.removeItem("authDetails"),S("/"),!0}catch(e){return g({message:e.message||"Logout failed",type:"error"}),!1}}}});export{ee as u};
